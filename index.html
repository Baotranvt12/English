<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>H·ªçc T·ª´ V·ª±ng Ti·∫øng Anh</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #f0f4f8;
      margin: 0;
      padding: 20px;
      display: flex;
      flex-direction: column;
      align-items: center;
    }
    h1 { color: #333; margin-bottom: 10px; }
    textarea {
      width: 100%; max-width: 520px; height: 150px;
      padding: 10px; border-radius: 5px; border: 1px solid #ccc;
      font-size: 16px; resize: none; margin-bottom: 10px;
    }
    button {
      padding: 10px 15px; background: #0078d7; border: none;
      color: white; border-radius: 5px; font-size: 16px;
      cursor: pointer; margin: 5px;
    }
    button:hover { background: #005fa3; }

    #quiz {
      margin-top: 20px; width: 100%; max-width: 520px;
      background: white; padding: 20px; border-radius: 10px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.1); display: none;
    }
    .question { font-size: 18px; margin-bottom: 10px; }
    input[type=text] {
      width: 100%; padding: 8px; font-size: 16px;
      border: 1px solid #ccc; border-radius: 5px; margin-bottom: 10px;
    }
    .result { font-weight: bold; margin-top: 5px; }
    .correct { color: green; }
    .incorrect { color: red; }

    #errorBox {
      color: white; background: #d9534f; padding: 10px;
      border-radius: 5px; margin-bottom: 10px; display: none;
      max-width: 520px; text-align: center;
    }

    #backBtn { background: #777; }
    #backBtn:hover { background: #555; }
  </style>
</head>
<body>
  <h1>H·ªçc T·ª´ V·ª±ng Ti·∫øng Anh</h1>

  <div id="errorBox"></div>

  <button id="pasteBtn">üìã D√°n nhanh</button>

  <p>Nh·∫≠p danh s√°ch t·ª´ v·ª±ng theo ƒë·ªãnh d·∫°ng:<br>
  <b>t·ª´_ti·∫øng_anh - nghƒ©a_ti·∫øng_vi·ªát</b><br>V√≠ d·ª•:<br>
  <i>dog - con ch√≥<br>apple - qu·∫£ t√°o</i></p>

  <textarea id="wordList" placeholder="Nh·∫≠p danh s√°ch t·ª´ v·ª±ng..."></textarea>
  <button id="formatBtn">‚ú® T·ª± ƒë·ªông l√†m s·∫°ch danh s√°ch</button>
  <button id="startBtn">B·∫Øt ƒë·∫ßu h·ªçc</button>

  <div id="quiz">
    <div id="questionArea"></div>
    <input type="text" id="answerInput" placeholder="Nh·∫≠p t·ª´ ti·∫øng Anh...">
    <div>
      <button id="checkBtn">Ki·ªÉm tra</button>
      <button id="nextBtn" style="display:none;">Ti·∫øp theo</button>
    </div>
    <div id="feedback" class="result"></div>
    <div id="summary" style="margin-top:15px; font-weight:bold;"></div>
    <hr>
    <button id="backBtn">üîô Quay l·∫°i t·∫°o danh s√°ch m·ªõi</button>
  </div>

  <script>
    const pasteBtn = document.getElementById("pasteBtn");
    const formatBtn = document.getElementById("formatBtn");
    const startBtn = document.getElementById("startBtn");
    const wordList = document.getElementById("wordList");
    const quiz = document.getElementById("quiz");
    const errorBox = document.getElementById("errorBox");
    const questionArea = document.getElementById("questionArea");
    const answerInput = document.getElementById("answerInput");
    const checkBtn = document.getElementById("checkBtn");
    const feedback = document.getElementById("feedback");
    const nextBtn = document.getElementById("nextBtn");
    const summary = document.getElementById("summary");
    const backBtn = document.getElementById("backBtn");

    let words = [];
    let currentIndex = 0;

    const REQUIRED_CORRECT = 5;

    function showError(msg) {
      errorBox.textContent = msg;
      errorBox.style.display = "block";
    }

    function hideError() {
      errorBox.style.display = "none";
    }

    function shuffle(array) {
      for (let i = array.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [array[i], array[j]] = [array[j], array[i]];
      }
      return array;
    }

    // ‚û§ 1. N√∫t D√°n Nhanh
    pasteBtn.addEventListener("click", async () => {
      try {
        const text = await navigator.clipboard.readText();
        wordList.value = text;
      } catch {
        showError("‚ö† Kh√¥ng th·ªÉ ƒë·ªçc clipboard. H√£y d√°n th·ªß c√¥ng b·∫±ng Ctrl+V.");
      }
    });

    // ‚û§ 2. T·ª± ƒë·ªông format l·∫°i danh s√°ch
    formatBtn.addEventListener("click", () => {
      hideError();
      let lines = wordList.value
        .split("\n")
        .map(l => l.trim())
        .filter(l => l);

      let cleaned = lines.map(line => {
        // Thay t·∫•t c·∫£ d·∫°ng g·∫°ch n·ªëi kh√°c nhau th√†nh '-'
        line = line.replace(/[‚Äì‚Äî‚àí]/g, "-");

        if (!line.includes("-")) return line;
        let [en, vi] = line.split("-");
        return en.trim().toLowerCase() + " - " + vi.trim();
      });(line => {
        if (!line.includes("-")) return line;
        let [en, vi] = line.split("-");
        return en.trim().toLowerCase() + " - " + vi.trim();
      });

      wordList.value = cleaned.join("\n");
    });

    // ‚û§ 3. B·∫Øt ƒë·∫ßu h·ªçc
    startBtn.addEventListener("click", () => {
      hideError();
      const lines = wordList.value.trim().split("\n").filter(line => line.includes("-"));

      if (lines.length === 0) {
        showError("‚ö† Vui l√≤ng nh·∫≠p danh s√°ch t·ª´ ƒë√∫ng ƒë·ªãnh d·∫°ng!");
        return;
      }

      words = lines.map(line => {
        const [en, vi] = line.split("-").map(x => x.trim());
        return { en, vi, correctCount: 0 };
      });

      shuffle(words);
      quiz.style.display = "block";
      wordList.style.display = "none";
      startBtn.style.display = "none";
      formatBtn.style.display = "none";
      pasteBtn.style.display = "none";

      showQuestion();
    });

    function showQuestion() {
      feedback.textContent = "";
      nextBtn.style.display = "none";
      answerInput.value = "";

      const unfinished = words.filter(w => w.correctCount < REQUIRED_CORRECT);
      if (unfinished.length === 0) {
        questionArea.innerHTML = "üéâ B·∫°n ƒë√£ thu·ªôc t·∫•t c·∫£ c√°c t·ª´!";
        return;
      }

      const randomWord = unfinished[Math.floor(Math.random() * unfinished.length)];
      currentIndex = words.indexOf(randomWord);
      const current = words[currentIndex];

      questionArea.innerHTML = `<div class="question">${current.vi}: (Nh·∫≠p t·ª´ ti·∫øng Anh)</div>`;
      answerInput.focus();
    }

    checkBtn.addEventListener("click", () => {
      const answer = answerInput.value.trim().toLowerCase();
      const currentWord = words[currentIndex];

      if (answer === currentWord.en.toLowerCase()) {
        currentWord.correctCount++;
        feedback.textContent = `‚úÖ Ch√≠nh x√°c! (${currentWord.correctCount}/${REQUIRED_CORRECT})`;
        feedback.className = "result correct";
      } else {
        feedback.textContent = `‚ùå Sai r·ªìi. ƒê√°p √°n ƒë√∫ng l√† \"${currentWord.en}\".`;
        feedback.className = "result incorrect";
      }

      nextBtn.style.display = "inline-block";
    });

    nextBtn.addEventListener("click", showQuestion);

    backBtn.addEventListener("click", () => {
      quiz.style.display = "none";
      wordList.style.display = "block";
      startBtn.style.display = "inline-block";
      formatBtn.style.display = "inline-block";
      pasteBtn.style.display = "inline-block";
      feedback.textContent = "";
    });
  </script>
</body>
</html>
